{
    "contents" : "\n\nrequire(dplyr)\nlibrary(googleVis)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\n\n### Input params ###\ntarget = 65\ns1 = 1\ns2 = 0.85\n\n# +-----------------------+\n# | Prepare data for plot |\n# +-----------------------+\n\nxfile.path = 'c:\\\\1\\\\USDRUB.txt'\ncol.date = 3\ncol.close = 8\nxdate.format = '%Y%m%d'\n\nraw.data = read.csv(file = xfile.path) #read.csv(file = 'c:\\\\1\\\\spx.csv') #\nprint(head(raw.data))\n\nraw.data = raw.data %>% select(col.date, col.close)\n\nnames(raw.data) = c('xdate', 'xclose')\n\nraw.data$xdate = as.Date(strptime(as.character(raw.data$xdate), xdate.format))\n\ntoday   = max(raw.data$xdate)\nexpdate = as.Date('15.12.2015', '%d.%m.%Y')\nfrstday =  today - (expdate - today)*2.5\n\ncurprice =subset(raw.data, xdate==today, xclose, drop=T)\ns1 = curprice * s1\ns2 = curprice * s2 \n\nadd.data = data.frame(xdate = as.Date(seq(from = today, to = expdate, by = 1)), xclose = NA, xtarget = target)\n\nraw.data1 = raw.data %>% filter(xdate > frstday) %>% bind_rows(add.data)\n\n# View(raw.data)\n\n# +-----------------------+\n# | Prepare data for plot |\n# +-----------------------+\n\ngchart = gvisComboChart(data = raw.data1, \n                          xvar=c('xdate'), \n                          yvar=c('xclose', 'xtarget'), \n                          options = list(\n                          series = \"[{color:'red', targetAxisIndex: 0, lineWidth: 2}, \n                                     {color: 'grey',targetAxisIndex: 0, lineWidth: 1, lineDashStyle: [4, 2]}]\",\n                          height=400, \n                          width=600, \n                          seriesType='line', \n                          legend= \"{ position: 'bottom' }\",   \n                          hAxis = \"{baselineColor: 'white', gridlines: {color: 'white'}}\"\n                          \n                                         ) )\n\ngchart$html$footer = ''\ngchart$html$caption = ''\n\n\nplot(gchart)\n\n# +-----------------------+\n# | Prepare data for plot |\n# +-----------------------+\n\nraw.data2 = gather(raw.data1, 'prices', 'values', 2:3)\n\n#bdays =  subset(raw.data2,  prices=='xclose', xdate)[[1]]\n\nggchart = ggplot(data = raw.data1, aes(x=xdate, y=xclose)) + \n  geom_line(size=1.2, color='red') + \n  scale_color_manual(values = c('red', 'grey30'), guide=guide_legend(title = NULL)) +\n  labs(x = NULL, y = NULL, title = NULL) + theme_bw(base_size = 16) + \n  theme(panel.border = element_rect(color='white'), \n        panel.grid.major.x=element_line(color='white'),\n        panel.grid.major.y=element_line(color='grey90'),\n        axis.ticks = element_line(color='grey50'),\n        axis.line = element_line(color='black'), axis.line.y = element_blank(),\n        legend.position=\"none\")\n\n\n### Add Target ###\nggchart = ggchart +\n  geom_segment(aes(x = today, xend = expdate, y = target, yend = target), color = 'red', linetype = 'dotted', size=1) +\n  geom_text(aes(label='Target', x=expdate, y=target, hjust=1, vjust=1), color='grey30', size=rel(6))\n\n### Add S1 ###\nggchart = ggchart +\n  geom_segment(aes(x = today, xend = expdate, y = s1, yend = s1), color = 'black', linetype = 'dotted') +\n  geom_text(aes(label='S1', x=today, y=s1, hjust=0, vjust=1.2), color='grey40') \n\n\n### Add S2 ###\nggchart = ggchart +\n  geom_segment(aes(x = today, xend = expdate, y = s2, yend = s2), color = 'black', linetype = 'dotted') +\n  geom_text(aes(label='S2', x=today, y=s2, hjust=0, vjust=-1), color='grey40') \n\n#+  scale_x_bd(business.dates = bdays )\noptions(bitmapType=\"cairo\")\nggsave(file='pic.png', plot = ggchart, scale = 2, height= 6, width= 10, dpi= 300, units = \"cm\")\n\n  \n  scale_x_date(limits = c(frstday+30, expdate), labels = date_format(\"%Y-%b\"))\n  theme( plot.title = element_text(size = rel(1)),  \n         panel.background = element_rect(fill = 'white'),\n         panel.grid.major = element_line(color = '#999999', size = 0) ) +\n  theme_get()\n          \n\nggchart\n\nView((raw.data2))\n\n\n### Areas for hedge ###\n\nggchart1 = ggplot(data = raw.data1, aes(x=xdate, y=xclose)) + \n  geom_line(size=1.2, color='red') + \n  scale_color_manual(values = c('red', 'grey30'), guide = guide_legend(title = NULL)) + \n  labs(x = NULL, y = NULL, title = NULL) + \n  theme_bw(base_size = 16) + \n  theme(panel.border       = element_rect(color='white'), \n        panel.grid.major.x = element_line(color='white'),\n        panel.grid.major.y = element_line(color='grey90'),\n        axis.ticks         = element_line(color='grey50'),\n        axis.line          = element_line(color='black'), \n        axis.line.y        = element_blank(),\n        legend.position=\"none\")\n\n### forward ###\nggchart1 = ggchart1 + \n  annotate('rect', xmax = expdate, xmin = today, ymin = curprice, ymax = Inf, fill = \"blue\", alpha=0.1) +\n  annotate('rect', xmax = expdate, xmin = today, ymin = -Inf, ymax = curprice, fill = \"red\", alpha=0.1) +\n  scale_y_continuous(limits = c(30, 80))\n\n\n### option ###\nggchart1 =\n  ggchart1 + annotate('rect', xmax = expdate, xmin = today, ymin = curprice*1.02, ymax = Inf, fill = \"blue\", alpha=0.1) +\n  scale_y_continuous(limits = c(30, 80))\n\n\n### risk reversal ###\nggchart1 = ggchart1 + \n  annotate('rect', xmax = expdate, xmin = today, ymin = curprice*1.1, ymax = Inf, fill = \"blue\", alpha=0.1) +\n  annotate('rect', xmax = expdate, xmin = today, ymin = -Inf, ymax = curprice*0.95, fill = \"red\", alpha=0.1) +\n  scale_y_continuous(limits = c(30, 80))\n\n\n### partly hedged forward ###\nggchart1 = ggchart1 + \n  annotate('rect', xmax = expdate, xmin = today, ymin = curprice, ymax = 65, fill = \"blue\", alpha=0.2) +\n  scale_y_continuous(limits = c(30, 80))\n\n\n### call spread ###\nggchart1 = ggchart1 + \n  annotate('rect', xmax = expdate, xmin = today, ymin = curprice*1.05, ymax = Inf, fill = \"blue\", alpha=0.2) +\n  scale_y_continuous(limits = c(30, 80))\n\noptions(bitmapType=\"cairo\")\nggsave(file=paste('hedge-', format(Sys.time(), '%Y-%m-%d_%H-%M'),'.png', sep=''), plot = ggchart1, scale = 2, height= 6, width= 10, dpi= 300, units = \"cm\")\n\n",
    "created" : 1435752446680.000,
    "dirty" : false,
    "encoding" : "CP1251",
    "folds" : "",
    "hash" : "2303863767",
    "id" : "708127D3",
    "lastKnownWriteTime" : 1434035199,
    "path" : "~/RBackup/OptionsPortfilioAnalyser/R/- chartsGvis.R",
    "project_path" : "R/- chartsGvis.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}